(function(b){function f(){c.text("[citation needed]").attr("disabled",!1)}function h(a,d,c,g,i){b.ajax({url:wgScriptPath+"/api.php",data:{action:"edit",title:wgPageName,section:a,summary:c,text:g,format:"json",token:d},dataType:"json",type:"POST",success:function(a){a.edit.result=="Success"?(i(),window.location.reload()):alert("Error: Unknown result from API.")},error:function(){alert("Error: Edit failed.");f()}})}function j(a){b.getJSON(wgScriptPath+"/api.php?",{action:"query",prop:"info",intoken:"edit",
titles:wgPageName,indexpageids:"",format:"json"},function(d){d.query.pages&&d.query.pageids&&a(d.query.pages[d.query.pageids[0]].edittoken)})}function e(){var a=window.getSelection();return{text:a.getRangeAt(0).toString(),element:a.anchorNode.parentNode}}function k(a,d){b.ajax({url:wgScriptPath+"/index.php",data:{action:"raw",title:wgPageName,section:a,oldid:wgCurRevisionId},dataType:"text",type:"GET",success:d,error:function(){alert("Error: get raw fail.")}})}function l(a,d,c){var g=((b(a.element).parents("#bodyContent > *").prevAll("h2,h3,h4,h5,h6").find(".editsection > a").get(0)||
b(a.element).prevAll("h2,h3,h4,h5,h6").find(".editsection > a").get(0)||{search:"section=0"}).search.match(/section=(\d+)/)||["",0])[1];k(g,function(b){var e=b.replace(RegExp(a.text),a.text+"{{Fact|time="+(new Date).toISOString().replace(/\.\d+Z$/,"Z")+"}}");e.length===b.length?(alert("Sorry, but I couldn't find the place to insert {{Fact}} in the wikitext."),f()):d()?j(function(b){h(g,b,"[citation needed]: "+a.text,e,c)}):f()})}if(wgIsArticle&&window.getSelection&&Date.prototype.toISOString){var c=
b("<button />").css({position:"absolute",fontSize:"8px"}).bind("click",function(){var a=e();a.text!==""&&(c.attr("disabled",!0).text("Working..."),l(a,function(){return window.confirm("Add [citation needed] to following selected text?\n\n"+a.text)},function(){c.text("Done! Reloading...")}))});f();b(document.body).append(c);b("#bodyContent").bind("mouseup",function(a){e().text!==""?c.css({top:a.pageY-20,left:a.pageX}).fadeIn(200):c.fadeOut(200)})}})(jQuery);

